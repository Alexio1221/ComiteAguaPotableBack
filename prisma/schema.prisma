generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  idUsuario    Int          @id @default(autoincrement())
  nombre       String
  apellido     String
  telefono     String       @unique
  chat_id      String?      @unique
  telegramToken String?     // <-- token temporal para deep link
  tokenExpira  DateTime?    // <-- opcional: expiración del token
  usuario      String       @unique
  contraseña  String
  creadoEn     DateTime     @default(now())
  modificadoEn DateTime     @updatedAt
  sesiones     Sesion[]
  roles        UsuarioRol[]
  recuperaciones Recuperacion[]
}

model Rol {
  idRol       Int          @id @default(autoincrement())
  nombreRol   String
  descripcion String
  funciones   Funcion[]
  usuarios    UsuarioRol[]
}

model UsuarioRol {
  idUsuario         Int
  idRol             Int
  estado            Boolean  @default(true) 
  fechaCreacion     DateTime @default(now())
  fechaModificacion DateTime @updatedAt
  rol               Rol      @relation(fields: [idRol], references: [idRol])
  usuario           Usuario  @relation(fields: [idUsuario], references: [idUsuario])

  @@id([idUsuario, idRol])
}

model Funcion {
  idFuncion     Int    @id @default(autoincrement())
  idRol         Int
  nombreFuncion String
  icono         String
  rol           Rol    @relation(fields: [idRol], references: [idRol])
}

model Sesion {
  idSesion      Int      @id @default(autoincrement())
  idUsuario     Int
  rolActual     String
  tokenSesion   String   @unique
  estado        Boolean  @default(true)
  creadoEn      DateTime @default(now())
  actualizadoEn DateTime @updatedAt
  usuario       Usuario  @relation(fields: [idUsuario], references: [idUsuario])
}

model Recuperacion {
  idRecuperacion Int      @id @default(autoincrement())
  idUsuario      Int
  codigo         String
  estado         Boolean  @default(true)  // true = activo, false = usado o expirado
  creadoEn       DateTime @default(now())
  expiraEn       DateTime  

  usuario        Usuario  @relation(fields: [idUsuario], references: [idUsuario])
}